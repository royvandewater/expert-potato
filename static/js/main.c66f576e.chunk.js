(this["webpackJsonpexpert-potato"]=this["webpackJsonpexpert-potato"]||[]).push([[0],{104:function(e,n,t){},105:function(e,n,t){},108:function(e,n){},110:function(e,n){},143:function(e,n){},144:function(e,n){},186:function(e,n,t){"use strict";t.r(n);var o=t(5),a=t.n(o),r=t(92),s=t.n(r),u=(t(104),t(95)),i=t(189),c=t(193),m=(t(105),t(93)),l=t(96),f=t(97),d=t(187),g=t(19),v=t(195),h=t(194),p=t(52),E=t(196),b=t(191),y=t(192),x=t(94);function w(e){var n=JSON.stringify(e);return x.createHash("sha1").update(n).digest("hex")}var k=function(e){Object(f.a)(t,e);var n=Object(l.a)(t);function t(e){var o,a=e.bus,r=e.index;return Object(m.a)(this,t),(o=n.call(this)).bus=void 0,o.index=void 0,o.messages=void 0,o.entries=void 0,o.sendMessage=function(e){var n={timestamp:Object(d.a)(Date.now()),author:"connection ".concat(o.index),text:e};o.messages.push(n),o.emit("messages:changed",h.a(o.messages)),o.sync()},o.rootHash=function(){o.entries={},o.messages.forEach((function(e){var n=w(e);o.entries[n]={type:"message",data:e}}));var e=p.a(o.entries);return o.merkle(e)},o.merkle=function(e){if(0===E.a(e))return null;if(1===E.a(e))return e[0];var n=function(e){for(var n=[],t=0;t<e.length;t+=2){var o=[],a=v.a(t,e),r=v.a(t+1,e);a&&o.push(a),r&&o.push(r),n.push(o)}return n}(e),t=[];return n.forEach((function(e){var n=w(e);o.entries[n]={type:"node",data:e},t.push(n)})),o.merkle(t)},o.onRoot=function(e){e!==o.rootHash()&&o.bus.emit("query",e)},o.onQuery=function(e){var n=o.entries[e];if(n)return"node"===n.type?o.bus.emit("node",n.data):"message"===n.type?o.bus.emit("message",n.data):void 0},o.onNode=function(e){e.forEach((function(e){o.entries[e]||o.bus.emit("query",e)}))},o.onMessage=function(e){b.a(y.a(e),o.messages)||(o.messages.push(e),o.messages.sort(),o.emit("messages:changed",h.a(o.messages)))},o.sync=function(){var e=o.rootHash();o.bus.emit("root",e)},o.log=function(){for(var e,n=arguments.length,t=new Array(n),a=0;a<n;a++)t[a]=arguments[a];(e=console).log.apply(e,["connection(".concat(o.index,")")].concat(t))},o.bus=a,o.index=r,o.messages=[],o.entries={},o.bus.on("root",o.onRoot),o.bus.on("query",o.onQuery),o.bus.on("node",o.onNode),o.bus.on("message",o.onMessage),o}return t}(g.EventEmitter),M=t(188),N=t(190),O=function(e){var n=e.connection,t=e.messages,o=a.a.useRef(null);return a.a.createElement("section",{className:"ConnectionSection"},a.a.createElement("h1",null,"Connection: ",n.index),a.a.createElement("div",null,a.a.createElement("form",{onSubmit:function(e){var t;e.preventDefault(),(null===(t=o.current)||void 0===t?void 0:t.value)&&(n.sendMessage(o.current.value),o.current.value="")}},a.a.createElement("input",{ref:o,type:"text"}),a.a.createElement("button",{type:"submit"},"Send"))),a.a.createElement("h2",null,"Messages"),a.a.createElement("div",{className:"Messages"},t.map((function(e,n){var t=e.timestamp,o=e.author,r=e.text;return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"Timestamp"},function(e){return Object(N.a)(Object(M.a)(e),"HH:mm:ss")}(t)),a.a.createElement("div",{className:"Author"},o),a.a.createElement("div",null,r))}))))};var j=function(){var e=a.a.useMemo((function(){return function(){var e=new g.EventEmitter;return e.on("root",(function(e){return console.log("on:root",e)})),e.on("query",(function(e){return console.log("on:query",e)})),e.on("node",(function(e){return console.log("on:node",e)})),e.on("message",(function(e){return console.log("on:message",e)})),window.bus=e,i.a((function(n){return new k({bus:e,index:n})}),3)}()}),[]),n=a.a.useState(e.map((function(e){return{index:e.index,messages:[]}}))),t=Object(u.a)(n,2),o=t[0],r=t[1];return a.a.useEffect((function(){return e.forEach((function(e){e.on("messages:changed",(function(n){var t=e.index;r((function(e){return c.a(t,{index:t,messages:n},e)}))}))})),function(){e.forEach((function(e){return e.removeAllListeners()}))}}),[e]),a.a.createElement("div",{className:"App"},e.map((function(e){return a.a.createElement(O,{key:e.index,connection:e,messages:o[e.index].messages})})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},99:function(e,n,t){e.exports=t(186)}},[[99,1,2]]]);
//# sourceMappingURL=main.c66f576e.chunk.js.map